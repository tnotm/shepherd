<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Shepherd Kiosk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-black text-gray-200 font-mono" onclick="toggleMenu(event)">

    <div class="h-full flex flex-col">

        <!-- BTC Price Section --><div id="btc-stats" class="flex-shrink-0 bg-yellow-400 text-black p-2">
            <div class="grid grid-cols-2 gap-4 text-center">
                <div>
                    <p class="text-sm font-bold uppercase tracking-wider">BTC Price</p>
                    <p class="text-3xl font-semibold">${{ herd_stats.btc_price }}</p>
                </div>
                <div>
                    <p class="text-sm font-bold uppercase tracking-wider">% 24HR</p>
                    <p class="text-3xl font-semibold {% if herd_stats.btc_change >= 0 %} text-green-700 {% else %} text-red-700 {% endif %}">{{ "%.2f"|format(herd_stats.btc_change) }}%</p>
                </div>
            </div>
        </div>

        <!-- Clock Section -->
        <div class="flex-grow bg-gray-800 text-white flex flex-col items-center justify-center text-center">
            <h1 id="clock-display" class="font-bold font-sans text-7xl tracking-tighter"></h1>
            <p id="clock-date" class="text-2xl mt-2"></p>
        </div>

        <!-- Herd Stats Section --><div id="herd-stats" class="flex-shrink-0 bg-black p-2">
            <div class="grid grid-cols-4 gap-4 text-center">
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Miners</p>
                    <p class="text-2xl font-semibold">{{ herd_stats.online_miners }}/{{ herd_stats.total_miners }}</p>
                </div>
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Herd Hash</p>
                    <p class="text-2xl font-semibold">{{ "%.2f"|format(herd_stats.total_hash_khs) }}</p>
                </div>
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Shares</p>
                    <p class="text-2xl font-semibold">{{ herd_stats.total_shares }}</p>
                </div>
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Templates</p>
                    <p class="text-2xl font-semibold">{{ herd_stats.total_block_templates }}</p>
                </div>
            </div>
        </div>
    </div>

    {% include '_navigation_menu.html' %}

    <script>
        function updateClock() {
            const clockDisplayElement = document.getElementById('clock-display');
            const dateElement = document.getElementById('clock-date');
            if (!clockDisplayElement || !dateElement) return;

            const now = new Date();
            
            // This will generate the full time string like "3:06:26 PM"
            const timeString = now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            clockDisplayElement.textContent = timeString;

            const dateString = now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            dateElement.textContent = dateString;
        }

        setInterval(updateClock, 1000);
        updateClock();

        setInterval(() => {
            // Prevent refresh if nav menu is open
            const navMenuPanel = document.getElementById('nav-menu-panel');
            if (navMenuPanel && !navMenuPanel.classList.contains('-translate-x-full')) {
                return;
            }
            fetch(window.location.href)
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    ['btc-stats', 'herd-stats'].forEach(id => {
                        const newEl = doc.getElementById(id);
                        if (newEl) document.getElementById(id).innerHTML = newEl.innerHTML;
                    });
                })
                .catch(err => console.error('Failed to refresh data:', err));
        }, 5000);
        
    </script>
</body>
</html>

