<!-- 
templates/kiosk.html
Version: 0.0.0.4
Description: Kiosk dashboard showing standard time/date, miner stats and BTC.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Shepherd Kiosk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-black text-gray-200 font-mono" onclick="toggleMenu(event)">

    <div class="h-full flex flex-col">

        <!-- BTC Price Section -->
        <div id="btc-stats" class="flex-shrink-0 bg-yellow-400 text-black p-2">
            <div class="grid grid-cols-2 gap-4 text-center">
                <div>
                    <p class="text-sm font-bold uppercase tracking-wider">BTC Price</p>
                    <p id="btc-price" class="text-3xl font-semibold">$--,--</p>
                </div>
                <div>
                    <p class="text-sm font-bold uppercase tracking-wider">% 24HR</p>
                    <p id="btc-change" class="text-3xl font-semibold">--.--%</p>
                </div>
            </div>
        </div>

        <!-- Clock Section -->
        <div class="flex-grow bg-gray-800 text-white flex flex-col items-center justify-center">
            <div id="clock-container" class="text-center">
                <h1 id="clock-time" class="text-7xl font-bold font-sans"></h1>
                <p id="clock-date" class="text-2xl mt-2"></p>
            </div>
        </div>

        <!-- Herd Stats Section -->
        <div id="herd-stats" class="flex-shrink-0 bg-black p-2">
            <div class="grid grid-cols-4 gap-4 text-center">
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Miners</p>
                    <p id="stat-miners" class="text-2xl font-semibold">--/--</p>
                </div>
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Herd Hash</p>
                    <p id="stat-hash" class="text-2xl font-semibold">--.--</p>
                </div>
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Shares</p>
                    <p id="stat-shares" class="text-2xl font-semibold">--</p>
                </div>
                <div>
                    <p class="text-xs font-bold uppercase text-cyan-400">Templates</p>
                    <p id="stat-templates" class="text-2xl font-semibold">--</p>
                </div>
            </div>
        </div>
    </div>

    {% include '_navigation_menu.html' %}

    <script>
        function updateClock() {
            const timeElement = document.getElementById('clock-time');
            const dateElement = document.getElementById('clock-date');
            if (!timeElement || !dateElement) return;

            const now = new Date();
            timeElement.textContent = now.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', second: '2-digit' });
            dateElement.textContent = now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        
        async function refreshData() {
             try {
                const response = await fetch('/api/herd_data');
                const data = await response.json();

                // Update BTC stats
                const btcData = data.btc_price_data;
                document.getElementById('btc-price').textContent = `$${btcData.price_usd.toLocaleString('en-US', {maximumFractionDigits: 2})}`;
                const btcChangeEl = document.getElementById('btc-change');
                btcChangeEl.textContent = `${btcData.change_24h.toFixed(2)}%`;
                btcChangeEl.className = 'text-3xl font-semibold '; // Reset
                if (btcData.change_24h >= 0) {
                    btcChangeEl.classList.add('text-green-700');
                } else {
                    btcChangeEl.classList.add('text-red-700');
                }

                // Update Herd stats
                const herdStats = data.herd_stats;
                document.getElementById('stat-miners').textContent = `${herdStats.online_miners}/${herdStats.total_miners}`;
                document.getElementById('stat-hash').textContent = herdStats.total_hash_khs.toFixed(2);
                document.getElementById('stat-shares').textContent = herdStats.total_shares.toLocaleString('en-US');
                document.getElementById('stat-templates').textContent = herdStats.total_block_templates.toLocaleString('en-US');

            } catch (error) {
                console.error('Failed to refresh data:', error);
            }
        }

        setInterval(updateClock, 1000);
        updateClock();

        setInterval(refreshData, 5000);
        document.addEventListener('DOMContentLoaded', refreshData);
    </script>
</body>
</html>

